<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Server-side Rendering · Treats</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;What server-side rendering (SSR) do is basically rendering our React markup that&#x27;s supposed to be only rendered on the client browser by our JavaScript bundle directly from our server. Our client-side bundle would then rehydrate our server-side rendered markup so it can be interactive later on.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Server-side Rendering · Treats"/><meta property="og:type" content="website"/><meta property="og:url" content="https://tokopedia.github.io/treats/treats/index.html"/><meta property="og:description" content="&lt;p&gt;What server-side rendering (SSR) do is basically rendering our React markup that&#x27;s supposed to be only rendered on the client browser by our JavaScript bundle directly from our server. Our client-side bundle would then rehydrate our server-side rendered markup so it can be interactive later on.&lt;/p&gt;
"/><meta property="og:image" content="https://tokopedia.github.io/treats/treats/img/toped.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://tokopedia.github.io/treats/treats/img/toped.png"/><link rel="shortcut icon" href="/treats/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/treats/css/main.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/treats/"><img class="logo" src="/treats/img/treats.png" alt="Treats"/><h2 class="headerTitleWithLogo">Treats</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/treats/docs/installation.html" target="_self">Getting Started</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Main Concepts</span></h2></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/installation.html">Installation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tutorial</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/tutorial/00.html">00. Tutorial is Coming Soon</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Main Concepts</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/routing.html">Routing</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/localization.html">Localization</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/code-splitting.html">Code-splitting</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/redux.html">Redux</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/graphql-client.html">GraphQL Client</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/middleware.html">Middlewares</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/helper.html">Helpers</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/server-side-event.html">Server-side Events</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/server-side-template.html">Server-side Template</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/treats/docs/main-concept/server-side-rendering.html">Server-side Rendering</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/custom-server-app.html">Custom Server App</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/custom-client-initialization.html">Custom Client Initialization</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/custom-react-app.html">Custom React App</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/runtime-config.html">Runtime Config</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/build-config.html">Build Config</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/environment-variable.html">Environment Variables</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/generator.html">Code Generator</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/scripts.html">Scripts</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/main-concept/addons.html">Addons</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API Reference</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/filesystem-hooks.html">Filesystem Hooks</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/component.html">Components</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/server.html">Server</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/client.html">Client</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/router.html">Router</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/intl.html">Intl</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/locale-data.html">Locale Data</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/helmet.html">Helmet</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/redux.html">Redux</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/api-reference/graphql.html">Graphql</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Authoring Addons</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/authoring-addons/overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/authoring-addons/helper.html">Helpers</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/authoring-addons/middleware.html">Middlewares</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/authoring-addons/generator.html">Generators</a></li><li class="navListItem"><a class="navItem" href="/treats/docs/authoring-addons/wrap-up.html">Wrapping Up</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Addons</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/list-of-addons.html">Treats Addons List</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Contributing</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/contributing/how-to-contribute.html">How To Contribute</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">FAQ</h3><ul><li class="navListItem"><a class="navItem" href="/treats/docs/faq.html">FAQs</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Server-side Rendering</h1></header><article><div><span><p>What server-side rendering (SSR) do is basically rendering our React markup that's supposed to be only rendered on the client browser by our JavaScript bundle directly from our server. Our client-side bundle would then rehydrate our server-side rendered markup so it can be interactive later on.</p>
<p>There's several reason for why we want to server-side render our React app. First, server-side rendered web app are more crawler friendly, so it can then boost our SEO ranking better, especially for crawlers that didn't run JavaScript. Second, our initial page load would be faster, since users can immediately see informations on our site, and when our JavaScript bundle finally arrives, it would just need to rehydrate our server-side rendered markup instead of regenerating all the DOM element again.</p>
<p>Creating server-side rendered React web apps are known to be very painful process since you need to configure lots of things from the server, data loading process, etc. But fret' not, since Treats are designed to supports SSR by default, we can just add few adjustments to our pages component and let Treats handle the rest.</p>
<p>To implement SSR in Treats, we can just provide <code>getInitialState</code> static method for our page component. The <code>getInitialState</code> method would then receives router and server context object that could be used as sources for any data fetching or state adjustment that you may want to make from our server-side actions. For example:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// src/pages/my-page/my-page.js</span>
<span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> myAction <span class="hljs-keyword">from</span> <span class="hljs-string">"../redux/my-action"</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    ....
    static <span class="hljs-keyword">async</span> getInitialState({ router, serverContext}) {
        <span class="hljs-keyword">const</span> { req, reduxStore } = serverContext;
        <span class="hljs-keyword">return</span> reduxStore.dispatch(myAction.serverSideRender(req));
    }
    render() {
        <span class="hljs-keyword">const</span> { status, myData } = <span class="hljs-keyword">this</span>.props;
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                {status === "loading" &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Loading....<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>}
                {status === "done" &amp;&amp; myData &amp;&amp; myData.length &gt; 0 &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                    {myData.map(datum =&gt; {
                        <span class="hljs-tag">&lt;<span class="hljs-name">RENDER</span> <span class="hljs-attr">SOMETHING</span> <span class="hljs-attr">WITH</span> <span class="hljs-attr">THE</span> <span class="hljs-attr">DATA</span>&gt;</span>
                    })}
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        );
    }
}

const mapStateToProps = state =&gt; ({
    status: state.status,
    myData: state.myData
});

const mapDispatchToProps = dispatch =&gt; ({
    ...
});

export default AsyncComponent(module, connect(mapStateToProps, mapDispatchToProps)(MyPage));
</span></code></pre>
<p>To define <code>getInitialState</code> from functional component:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// src/pages/my-page/my-page.js</span>
<span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> myAction <span class="hljs-keyword">from</span> <span class="hljs-string">"../redux/my-action"</span>;

<span class="hljs-keyword">const</span> MyPage = <span class="hljs-function">(<span class="hljs-params">{ status, myData }</span>) =&gt;</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        {status === "loading" &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Loading....<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>}
        {status === "done" &amp;&amp; myData &amp;&amp; myData.length &gt; 0 &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            {myData.map(datum =&gt; {
                <span class="hljs-tag">&lt;<span class="hljs-name">RENDER</span> <span class="hljs-attr">SOMETHING</span> <span class="hljs-attr">WITH</span> <span class="hljs-attr">THE</span> <span class="hljs-attr">DATA</span>&gt;</span>
            })}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
);

MyPage.getInitialState = async ({ router, serverContext}) =&gt; {
    const { req, reduxStore } = serverContext;
    return reduxStore.dispatch(myAction.serverSideRender(req));
};

const mapStateToProps = async (state) =&gt; ({
    status: state.status,
    myData: state.myData
});

const mapDispatchToProps = dispatch =&gt; ({
    ...
});

export default AsyncComponent(module, connect(mapStateToProps, mapDispatchToProps)(MyPage));
</span></code></pre>
<p>And don't forget to register our page in the router definition like so:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// src/_route/module.js</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [{
    <span class="hljs-attr">name</span>: <span class="hljs-string">"my-page"</span>,
    <span class="hljs-attr">path</span>: <span class="hljs-string">"/my-page"</span>
}]
</code></pre>
<pre><code class="hljs css language-js"><span class="hljs-comment">// src/_route/route.js</span>

<span class="hljs-keyword">import</span> MyPage <span class="hljs-keyword">from</span> <span class="hljs-string">"../page/my-page"</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-string">"/my-page"</span>: MyPage
};
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="router-and-server-context-object"></a><a href="#router-and-server-context-object" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Router and Server Context Object</h2>
<p>Router and server context object would always be passed on our page's <code>getInitialState</code> method, these object can then be used to determine what action would be made to render our React app on the server:</p>
<ol>
<li><code>router</code> object contains current matched route for this component. This is basically the compiled version of our route definition, for the example above, the router object would be:</li>
</ol>
<pre><code class="hljs css language-js">{
    <span class="hljs-attr">name</span>: <span class="hljs-string">"my-page"</span>,
    <span class="hljs-attr">path</span>: <span class="hljs-string">"/my-page"</span>,
    <span class="hljs-attr">component</span>: MyPage
}
</code></pre>
<ol start="2">
<li><p><code>serverContext</code> object contains <code>req</code>, <code>res</code>, <code>reduxStore</code>, and <code>apolloClient</code>:</p>
<ul>
<li><code>req</code> <strong>object</strong> express request object.</li>
<li><code>res</code> <strong>object</strong> express response object.</li>
<li><code>reduxStore</code> <strong>Redux Store</strong> redux store that is specifically created for current request.</li>
<li><code>apolloClient</code> <strong>Apollo Client</strong> Apollo GraphQL client that is specifically created for the current request.</li>
</ul></li>
</ol>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/treats/docs/main-concept/server-side-template.html"><span class="arrow-prev">← </span><span>Server-side Template</span></a><a class="docs-next button" href="/treats/docs/main-concept/custom-server-app.html"><span>Custom Server App</span><span class="arrow-next"> →</span></a></div></div></div></div><footer class="nav-footer" id="footer"><a href="https://github.com/tokopedia/" target="_blank" rel="noreferrer noopener" class="tkpdOpensource"><img class="tkpdOpenSourceLogo" src="/treats/img/tokopedia.png" alt="Tokopedia Open Source"/></a><section class="copyright">Copyright © 2018 Tokopedia OSS</section></footer></div></body></html>